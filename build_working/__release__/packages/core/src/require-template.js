define("template",["jquery","packages/core/src/lib/handlebars","require"],function($,Handlebars,req){function getKey(e){return e.replace(/[\.\/]/g,"_")}function Template(){}var runningTemplatePath=null;Handlebars.registerHelper("rel",function(e){return require.toUrl(runningTemplatePath+e)});var logger=console;return require.specified("logger")&&req(["logger"],function(e){logger=e}),Template.prototype.renderToView=function(e,t){var n=this.render(t),r=$(n);e.id&&(r.attr("id")||r.attr("id",e.id));var i=$(e.$element||e.$el);e.setElement(r),i.replaceWith(r)},Template.prototype.load=function(e,t,n,r){function i(t){var n=t.render,r=e.replace(/[^\/]+$/,"");t.render=function(e){e=e||{},runningTemplatePath=r;var i=n.call(t,e);return runningTemplatePath=null,i}}var s=new Template;if(!r.isBuild){var o=getKey(e);s.location=e,t.specified(o)?t([o],function(e){s.render=function(t){return Handlebars.template(e)(t)},i(s),n(s)}):$.ajax(t.toUrl(e),{dataType:"text"}).done(function(e){s.render=Handlebars.compile(e),i(s),n(s)})}else n()},Template.prototype.normalize=function(e,t){e.match(/\.html?$/)==null&&(e+=".html"),e.match(/\[(.*)\]/)&&(logger.log("Usage of brackets to template! plugin is deprecated and not likely to work.  Please use relative paths instead.  name: "+e,logger.WARNING),e=e.replace(/\[(.*)\]\/?(.*)/,"packages/$1/content/$2"));var n="",r=e.lastIndexOf("!");return r>0&&(n=e.substring(0,r+1),e=e.substring(r+1)),n+t(e)},Template.prototype.write=function(pluginName,moduleName,write){var fs=require.nodeRequire("fs"),HandlebarsShim="(function() {var module = undefined;"+fs.readFileSync("../build/handlebars.js").toString()+"return Handlebars;})();",Handlebars=eval(HandlebarsShim),renderFunc=fs.readFileSync(moduleName).toString().replace(/^\uFEFF/,"");renderFunc=Handlebars.precompile(renderFunc).toString(),write.asModule(getKey(moduleName),"define(function() { return ("+renderFunc+"); });")},new Template})